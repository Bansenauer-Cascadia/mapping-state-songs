<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>State Tuned</title>

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

	<link rel="stylesheet" href="css/jquery.mobile.structure-1.3.0.min.css" />
	<link rel="stylesheet" href="css/jquery.mobile.theme-1.3.0.min.css" />
	<script src="http://debug.phonegap.com/target/target-script-min.js#StateTuned"></script>	
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/cordova.ios.js"></script>

	<!-- Scripts for Phonegap Build plugin injection -->
	<script src="phonegap.js"></script>
	<script src="childbrowser.js"></script>
	<script src="barcodescanner.js"></script>
	<script src="js/js.js"></script>
    <script src="js/music.js"></script>
	<link rel="stylesheet" href="css/styles.css" />
    <script>
        var song,
            state,
            songList; 

        // wait until the device is ready
        document.addEventListener("deviceready", onDeviceReady, false);

        //Perform actions on device ready


        function setUpDB(tx) {
            tx.executeSql('DROP TABLE IF EXISTS StateTuning'); // for testing purposes. remove from final product!
            tx.executeSql('CREATE TABLE IF NOT EXISTS StateTuning (id INTEGER primary key, state, song)'); //Creating the table of it doesn't exist
        }


        //
        function likeSongDB(tx) {
            console.log('INSERT INTO StateTuning (state, song) VALUES ("' + state + '", "' + song + '")');
            tx.executeSql('INSERT INTO StateTuning (state, song) VALUES ("' + state + '", "' + song + '")'); //Inserting two records for testing

        }
        // Query all of the database
        //
        function queryDB(tx) {
            tx.executeSql('SELECT * FROM StateTuning', [], querySuccess, errorCB); // Quering the data
        }

        // Query the success callback
        //
        function querySuccess(tx, results) {
            var len = results.rows.length;
            console.log("StateTuning table: " + len + " rows found.");
            for (var i = 0; i < len; i++) {
                console.log("Row = " + i + " ID = " + results.rows.item(i).id + " State =  " + results.rows.item(i).state + " Song = " + results.rows.item(i).song);
            }
        }

        // Transaction error callback
        //
        function errorCB(err) {
            console.log("Error processing SQL: " + err.code);
        }

        // Transaction success callback
        //
        function successCB() {
            var db = window.openDatabase("StateTuning", "1.0", "StateTuning", 200000);
            db.transaction(queryDB, errorCB);
        }

        function scanGrabSongs() {
            $.get('http://216.186.69.45/state_tunes/' + state, function (data) {
                songList = data; //LUCAS YOU CAN WORK WITH THIS VARIABLE FOR THE LIST OF SONGS
                console.log(songList); // DELETE AFTER TESTING
            });
        }

        // Cordova is ready
        //
        function onDeviceReady() {
            var db = window.openDatabase("StateTuning", "1.0", "StateTuning", 200000);
            db.transaction(setUpDB, errorCB, successCB);

            $('.likeButton').click(function () {
                song = $(this).parent().data('song');
                state = $('#state').data('state');

                db.transaction(likeSongDB, errorCB, successCB);
                $.ajax({
                    url: "http://216.186.69.45/like_tune/" + song,
                    type: 'PUT',
                    success: function (response) {
                        console.log('PUT Completed');
                    }
                })
                $(this).attr("src",'images/redHeart.png');
            });

            scanGrabSongs();
        }


        //============================================================================================================
        $.ajax({
            type: 'GET',
            url: 'http://216.186.69.45/state_list/' + state,
            dataType: 'json',
        });

        $.ajax({
            type: 'GET',
            url: 'http://216.186.69.45/state_tunes/' + state,
            dataType: 'json',
        });


        $("#statename").html(state.name);


        var theWholeThing;
        for (I = 0; I < tunes.length; I++)
        {
            theWholeThing += "<li id=\"song\" data-song=\"5\"><a href=\"#\" class=\"btn large\" onclick=\"playAudio('" + tunes[I].content + "');\"><img src=\"images/play.png\"></a><a href=\"#\" class=\"btn large\" onclick=\"pauseAudio();\"><img src=\"images/pause.png\"></a>" + tunes[I].content + "</li>"
        }
        document.getElementById('listOfSongs').innerHTML = theWholeThing;


        //picture
        var thepath = "images/" + state + ".jpeg"
        $("#statepic").attr("src", thepath);



    //"<li id=\"song\" data-song=\"5\"><a href=\"#\" class=\"btn large\" onclick=\"playAudio('" + songurl + "');\"><img src=\"images/play.png\"></a><a href=\"#\" class=\"btn large\" onclick=\"pauseAudio();\"><img src=\"images/pause.png\"></a>" + song.name + "</li>"




        //=--------
    </script>
</head>
<body>

	<!-- Page: home -->

	<div id="home"
		data-role="page"
		data-title="StateTuned: Home">
		<div data-role="header"
			data-position="fixed">
		</div>
		<div data-role="content">
			<div class="scanButton">SCAN</div>
		</div>
        <div data-role="footer" data-position="fixed">
			<a class="about footerButton" href="#second">ABOUT US</a>
            <a class="facebook footerButton" href="#facebook">facebook</a>
		</div>

	</div>

	<!-- Page: second screen State Page -->
    <!--============================================================-->
	<div id="second"
		data-role="page"
		data-title="StateTuned: State Screen">
		<div data-role="header"
			data-position="fixed">	
		</div>
		<div data-role="content">
			<h1 id="statename">Washington</h1>	<!-- This is where the state name will go -->
			<img id="statepic" src="images/wa.jpeg">	<!-- This is where the state artwork will go -->
			<!-- List of songs -->
            
                <ul id="listOfSongs">

                    
                </ul>

			<div data-role="footer">
				<a class="scanButton" data-role="button">Scan</a>
				<a class="aboutButton" data-role="button">About</a>
				<a class="FBButton" data-role="button">FB</a>

            </div>
		</div>
	</div>
    <!--============================================================-->

	<!-- Dialog Content -->
	
	<div data-role="page"
		id="aboutPage"
		data-title="StateTuned: About">
		<div data-role="header"
			data-position="fixed">
		</div>
		<div data-role="content">
        	<p>Some content goes here</p>
		</div>
        <div data-role="footer" data-position="fixed">
			<a class="about footerButton" href="#aboutPage">ABOUT US</a>
            <a class="facebook footerButton" href="#facebook">facebook</a>
		</div>

	</div>
		
</body>
</html>
